---
title: "ETC5521 Assignment 1"
subtitle: "Contribution of domestic clubs towards world cup success in women's soccer"
team: wattle
author:
  - Ketan Kabu  31554679
  - Yiwen Zhang 31203019
date: "`r Sys.Date()`"
bibliography: references.bib
biblio-style: authoryear-comp
output: 
  bookdown::html_document2:
   citation_package: biblatex
   toc: TRUE
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, message=FALSE,warning = FALSE,comment = FALSE,fig.pos = 'H')

library(ggplot2)
library(tidyverse)
library(kableExtra)
library(dplyr)
library(plotly)
library(bookdown)
```

```{r readdata}
wwc_outcomes <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-07-09/wwc_outcomes.csv")
squads <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-07-09/squads.csv")
codes <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-07-09/codes.csv")

```


# Introduction and motivation

Women's soccer has gained a lot of media attention in the last few years, and deserving so. Countries like the USA, a dominant force in women's soccer, have produced some top quality players like Megan Rapinoe, Carli Lloyd, Alex Morgan and Julie Ertz. Just north of the USA, Christine Sinclair from Canada became the first player to win the Lou Marsh Award as Canadian Athlete of the Year, which is unsurprising considering her outstanding haul of 182 career international goals. Ada Hegerberg from Norway became the first woman to win the prestigious Ballon d'Or award, an yearly honor awarded to best player in the world, which was first introduced for the women's game in 2018.[@sportmob2020]

The advancement of women's soccer has been parallel with the understanding and acceptance of data and analytic in the game. The technological advancement in capturing and analysing data has exploded since the late 1990s, when it began. Clubs have used this technology to identify and scout talent from all over the world.

Every country has a different approach towards coaching and developing talent. Success at an international level could be down to the ability of world class players playing with a certain level of chemistry, which could be challenging as it is common for them to be playing for different rival clubs at the domestic level. In the men's game, we saw Italy, Spain and Germany winning world cups in 2006, 2010 and 2014 respectively. Many partly attributed the success of these teams towards the fact that majority of these players playing in the same domestic league (or country), or even in the same club, especially those clubs that produce the most successful international players.

In this paper, we will approach the women's game with the same lens. We believe that these findings could prove meaningful to coaches, scouts and even young players in the game looking to choose clubs to play for with future international success in mind.
 
The squads data set also provided the information regarding a player's position on the field, be it the Midfielders, Defenders and Goalkeepers. Each have various other parameters they can be judged on - like assists, distance covered in a match, tackles, clearances, saves(goalkeepers) and various others. If this information is available, better player performance insights can be achieved. However, we only have the goals information which may not did a justice for any positions rather than the Forwards. For the sake of this report, we will forgo the analysis of the player's position, as analysis many not make a lot of sense with the current level of information provided.  

We could also do match by match analysis of the world cup if we can obtain information about how each player was rated, or scored certain number of goals, in a world cup match.
In our clubs data, we have a reference named as "Unattached", which will appear sometimes in our analysis. This signifies that the player(s) is not contracted with any domestic club when the data was collected.


# Data description

This data set is about Women's World Cup, which originally comes from website data.world <https://data.world/sportsvizsunday/womens-world-cup-data>.It consists of final score and win/loss status data from 1991-2019. Additionally, the 2019 world cup rosters for each team are included. After being cleaned by a data analyst, we downloaded the data from his github <https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-07-09>.
There are three .csv files in this data set to manage and store the data, and they are named "codes", "squads" and "wwc_outcomes".  

"wwc_outcomes.csv" has seven variables:  
```{r}
head(wwc_outcomes)
```

- "year" represents the year of tournament,  
- "team" is the abbreviated team name,  
- "score" means the score by team, 
- "round" means the round of the tournament, includes: "Group", "Quarter Final", "Semi Final", "Third Place Playoff", "Final" and "Round of 16",   
    +) Ground: In the first stage (the "Group Stage"), the 32 teams are placed into eight groups of four teams each, The top two teams from each group advance to the second stage (the 'Knockout Stage'). If two or more teams finish even on points, tie-breakers are used: the first is 'goal differential' then total goals scored, then head-to-head results, and finally drawing of lots.  
    +) Round of 16:  the winner of each Group plays against the runner-up from another group  
    +) Quarter final  --> Semi Finals --> Final  
    +) Third place playoff: The losing semi-finalists play a match for third place.  
- "yearly_game_id" is a grouping variable for matches in each world cup,   
- "team_num" is 1 or 2 representing teams in each match, and  
- "win_status" represents a team win or loss. 

In "squads.csv":
```{r clean-squads}
# load the squad information for the remaining world cups
wc_squad_full <- read.csv(here::here("femalewwc_squad.csv")) %>%
  mutate(dob = as.Date(dob, format = "%d-%B-%Y"))

# Update missing info for squads_raw
squads <- squads %>%
  mutate(
    caps = case_when(
    str_detect(player, "Xu Huan") ~ 1,
    str_detect(player, "Lin Yuping") ~ 13,
    str_detect(player, "Wang Yan") ~ 28,
    str_detect(player, "Wang Ying") ~ 4,
    str_detect(player, "Li Wen") ~ 32,
    str_detect(player, "Bi Xiaolin") ~ 35,
    str_detect(player, "Yao Wei") ~ 14,
    str_detect(player, "Luo Guiping") ~ 1,
    str_detect(player, "Liu Yanqiu") ~ 2,
    TRUE ~ caps
  ),
  goals = case_when(
    str_detect(player, "Xu Huan") ~ 0,
    str_detect(player, "Lin Yuping") ~ 0,
    str_detect(player, "Wang Yan") ~ 0,
    str_detect(player, "Wang Ying") ~ 0,
    str_detect(player, "Li Wen") ~ 3,
    str_detect(player, "Bi Xiaolin") ~ 0,
    str_detect(player, "Yao Wei") ~ 3,
    str_detect(player, "Luo Guiping") ~ 0,
    str_detect(player, "Liu Yanqiu") ~ 0,
    TRUE ~ goals)
  )
    
# row binds with 2019 squad info
squads <- squads %>%
  mutate(year = 2019) 
squads <- squads %>%
  rbind(wc_squad_full)

# manually fix the name of some clubs to avoid mismatch
squads <- squads %>%
  mutate(club = case_when(
    str_detect(club, "Olympique Lyon") ~ "Lyon",
    str_detect(club, "Olympique Lyonnais") ~ "Lyon",
    str_detect(club, "Ajax") ~ "AFC Ajax",
    str_detect(club, "AIK Fotboll") ~ "AIK",
    str_detect(club, "Asker S.K.") ~ "Asker SK",
    str_detect(club, "Avaldsnes") ~ "Avaldsnes IL",
    str_detect(club, "Bangkok F.C.") ~ "Bangkok",
    str_detect(club, "Klepp") ~ "Klepp IL",
    str_detect(club, "Urawa Red Diamonds") ~ "Urawa Red Diamonds Ladies",
    str_detect(club, "Urawa Reds Ladies") ~ "Urawa Red Diamonds Ladies",
    str_detect(club, "Linköping FC") ~ "Linköping",
    str_detect(club, "Arna-Bjørnar") ~ "Arna-Bjornar",
    str_detect(club, "Arsenal L.F.C.") ~ "Arsenal",
    str_detect(club, "Bayelsa Queens FC") ~ "Bayelsa Queens",
    str_detect(club, "Beijing Chengjian") ~ "Beijing Chenjian",
    str_detect(club, "Birmingham City L.F.C.") ~ "Birmingham City",
    str_detect(club, "Changchun Zhuoyue [zh]") ~ "Changchun Zhuoyue",
    str_detect(club, "Chelsea L.F.C.") ~ "Chelsea",
    str_detect(club, "Delta Queens FC") ~ "Delta Queens",
    str_detect(club, "Djurgården") ~ "Djurgårdens IF",
    str_detect(club, "Doncaster Rovers Belles LFC") ~ "Doncaster Rovers Belles",
    str_detect(club, "Eastern Suburbs AFC") ~ "Eastern Suburbs",
    str_detect(club, "Everton L.F.C.") ~ "Everton",
    str_detect(club, "FC Barcelona") ~ "Barcelona",
    str_detect(club, "FFC Frankfurt") ~ "1. FFC Frankfurt",
    str_detect(club, "FFC Turbine Potsdam") ~ "1. FFC Turbine Potsdam",
    str_detect(club, "KIF Örebro DFF") ~ "KIF Örebro",
    str_detect(club, "Kolbotn Fotball") ~ "Kolbotn",
    str_detect(club, "Kristianstads DFF") ~ "Kristianstads",
    str_detect(club, "Levante UD") ~ "Levante",
    str_detect(club, "Louves Miniproff [de]") ~ "Louves Minproff",
    str_detect(club, "LSK Kvinner FK") ~ "LSK Kvinner",
    str_detect(club, "Melbourne Victory FC") ~ "Melbourne Victory",
    str_detect(club, "Montpellier") ~ "Montpellier",
    str_detect(club, "Nasarawa Amazons FC") ~ "Nasarawa Amazons",
    str_detect(club, "Pelican Stars FC") ~ "Pelican Stars",
    str_detect(club, "Piteå") ~ "Piteå",
    str_detect(club, "Rivers Angels FC") ~ "Rivers Angels",
    str_detect(club, "Sevilla FC") ~ "Sevilla",
    str_detect(club, "Sky Blue FC") ~ "Sky Blue",
    str_detect(club, "Stabæk Fotball") ~ "Stabæk",
    str_detect(club, "Tianjin Teda F.C.") ~ "Tianjin Teda",
    str_detect(club, "Trondheims-Ørn SK") ~ "Trondheims-Ørn",
    str_detect(club, "Tyresö FF") ~ "Tyresö",
    str_detect(club, "Umeå IK") ~ "Umeå",
    str_detect(club, "Valencia CF") ~ "Valencia",
    str_detect(club, "Vegalta Sendai") ~ "Vegalta Sendai Ladies",
    str_detect(club, "Vittsjö GIK") ~ "Vittsjö",
    str_detect(club, "Wuhan Jianghan University [zh]") ~ "Wuhan Jianghan Univ.",
    str_detect(club, "SwedenJitex BK") ~ "Jitex BK",
    str_detect(club, "EnglandNotts County") ~ "Notts County",
    TRUE ~ club
  ))
```

- "squad_no" is the player jersey number from 1 to 23,  
- "country" shows the country of the team,  
- "pos" is the position of player,  
- "player" shows the name of the player,  
- "dob" is date of birth,   
- "age" is the players' ages,  
- "caps" displays the number of international games played by the player,  
- "goal" is the number of international goals scored by the player, and  
- "club" shows which domestic club the player belongs to.


# Changes from Assignment 1:
In the previous stage of this report, the **wattle** team had performed a range of analysis on the player contribution by club, goals score. player's cap and player position. Even though the analysis was done thoroughly, the works lacked direction towards answering the primary question. In this improvised version, we tried to re- address the wattle team's analysis by expanding the scope (by obtaining more data) to direct the results towards answering the primary question.  

Details of change are as follow:   
- Primary question was introduced, and small questions were added and revised to better facilitate the primary question.  
- Report structure: We introduced a new primary question and a set of small questions. Thus the report was restructured to reflect the appearance of new questions.  
- Data description: We obtained more data, so we do further introduction. Also the missing values analysis was conducted on both the new and old data sets.  
- Part 3.1 _Clubs that provided the most number of world cup players_:  
  +) We relocated the _Overall contribution_ to under the new _Analysis by club_ and expanded the work using the data of other World Cup tournaments as well.  
  +) The _Goal scorers_ was removed as we wanted to discuss the relationship among the age, caps and the goals to determine the characteristic of a World Cup player.  
- Part 3.2 _Cap contribution by clubs_:  
  +) The _Contribution by clubs in terms of players’ caps_ was relocated to under the new _Analysis by players_.  
  +) The _Clubs that provide players that are young and also highly experienced_ was removed as we will discuss the players'age in a separate section under the _Analysis by players_ section.  
  +) The _Contribution by clubs in terms of player position_ was removed as we deemed irrelevant to the main question and contained less useful information.  
- Conclusion: new conclusion to associate with new analysis.  

# Analysis and findings

Before we start, there are a couple of questions we need to bear in mind to serve as the guidelines for our analysis, they are:

Primary question: What factors would describe a World Cup participant's characteristics and if possible, the World Cup champion?

- How does the a player's domestic club influence her performance?

- How does the age and the caps of a player influence her performance?

- Is there any relation between the age of a player, the caps she has achieved and the goals she made?

## Analysis by country

```{r}
# reference the country code in the wwc_outcomes
wwc_outcomes_fullname <- wwc_outcomes %>%
  left_join(codes, by = "team")
```

```{r team-result}
# count the number of rounds participated by each country
team_count <- wwc_outcomes_fullname %>%
  select(country, year, score) %>%
  count(country, year) %>%
  rename("rounds" = n)
# calculate the result for each team
team_result <-wwc_outcomes_fullname %>%
  select(country, year, score) %>%
  group_by(country, year) %>%
  summarise(total_score = sum(score)) %>%
  ungroup()
# bind the two tables to calculate avg score/ round
avg_score_per_round <- team_result %>%
  left_join(team_count, by = c("country", "year")) %>%
  mutate(avg_score = total_score/rounds)
```


## Analysis by club

To find out what factors could determined a World Cup player, we tried to looked at two elements of her career: the player herself and the club that she played for in her normal time not attending the World Cup. In this section, we will have a look at the club first.  
It's no surprise when we would see some clubs or leagues that better represents the players than the others. Those clubs usually are big in size, providing more resources to produce a quality player. In the figure \@ref(fig:player-contri) below, we will examine the biggest 12 clubs that are or were home to the highest numbers of World Cup players.  

```{r player-contri, fig.cap = "Contribution of World Cup players by clubs from 2007 to 2019"}
wc_clubs_players <- squads %>% 
  # leave the unattached out to count
  # filter out 2003 as clubs info were missing
  filter(year > 2003,
         !club == "Unattached") %>%
  group_by(club) %>%
  # count the unique players only as one player could attend more than one WC
  summarise("Player" = n_distinct(player)) %>% 
  arrange(desc(Player))

wc_clubs_players %>% 
  head(12) %>% 
  kable(booktabs = TRUE, caption = "Contribution of World Cup players by clubs from 2007 to 2019") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

We filtered for the 2007 World Cup up to 2019 World Cup (4 tournaments in total) as the club's information was not fully provided for all of the prior tournaments. After that we counted the number of unique players that each club had brought to the World Cup. 

Lyon contributed the highest number of players throughout the four World Cup tournaments. Asides from Lyon, the France Women's First Division League had another national clubs got into the top 10, which was Paris Saint-Germain. Most of the other clubs in the ranking saw themselves belonged to the countries that are most well-known for their football history. They are Germany (1. FFC Frankfurt and VfL Wolfsburg), England (Arsenal and Chelsea), Norway (LSK Kvinner), Sweden (Linköping), Canada (Vancouver Whitecaps) and Spain (Barcelona).  

We have two special cases that top the chart: 25-Apr of North Korea and Rivers Angels of Nigeria. These two clubs were special in their own way that their national World Cup teams mostly consisted of their players. We will revisit this point again when we get to the breakdown of Domestical and Foreign elements of these 12 clubs later in this section.   

```{r top-10-by-year, fig.cap = "Clubs' players by year from WC2007-WC2019"}
squads %>% 
  # filter top twelve only
  filter(club %in% c("Lyon", "Arsenal", "Paris Saint-Germain", "1. FFC Frankfurt", "25-Apr",
                     "Barcelona", "Rivers Angels", "Chelsea", "Vancouver Whitecaps", "VfL Wolfsburg",
                     "Linköping", "LSK Kvinner"),
         year > 2003) %>%
  group_by(club, year) %>%
  # leave the unattached out to count
  # filter out 2003 as clubs info were missing
  summarise("Player" = n_distinct(player)) %>% 
  arrange(club, year) %>%
  ggplot(aes(x = factor(year), Player)) +
  geom_col(stat = "identity") +
  facet_wrap(~ club) +
  theme_bw() +
  xlab("year") +
  ggtitle("Clubs' players by year from WC2007-WC2019")
```

In terms of year, 5 out of the 12 clubs featured in the chart did not join the whole four World Cups. We can see clearly from the chart that 25-Apr had made an impressive contribution of players for the North Korea team in 2007 and 2011, which brought them to our ranking even though they dropped out in the recent two games. 

Except for Chelsea and Barcelona, other clubs did not observe a significant change in the number of World Cup player in 2019. Rather, most of them went down in numbers. There is a couple of explanations for this overvation:  
- 2015 was the first year that allowed the number of participated teams to increased from 16 in 2011 to 24. As a result, we will see that most clubs saw their players surged in number in 2015.  
- There is a fact in the football industry that big clubs usually hesitated to send their prominent players to the World Club. They want to reserve their stars for the national tournaments or other premier leagues. In the male football industry, this practice threatened the success of the World Cup so bad that FIFA even comes up with a commission scheme to pay the clubs for their "collaboration" [@homewood_2020]. A drop in the female players'number could suggest two things: (1) the women's football clubs also concerned for other games that they did not want to send away their star players, and (2) 2019 was the second World Cup that allowed 24 teams to participate. Other clubs might have used this chance to send their players off to the international field, making the share smaller for all.  

For (1), we was confirmed that FIFA had announced the first beneficial package to promote the clubs for participating in the Women's World Cup. This program was introduced ahead of the World Cup 2019. More details can be read [here](https://img.fifa.com/image/upload/imn0xwvea97tommxx5uz.pdf).  

Finally in this club section, we will look at the composition of the players that each of these 12 clubs sent to World Cup. Would they be playing along or against their comrades?

```{r top-12-by-year, fig.cap = "Percentage of domestical player of top 12"}
# Count the distinct nationals in each club in top 12
domestic <- squads %>% 
  # filter top 12 only
  filter(club %in% c("Lyon", "Arsenal", "Paris Saint-Germain", "1. FFC Frankfurt", "25-Apr",
                     "Barcelona", "Rivers Angels", "Chelsea", "Vancouver Whitecaps", "VfL Wolfsburg",
                     "Linköping", "LSK Kvinner"),
         year > 2003) %>%
  group_by(club, country) %>%
  # leave the unattached out to count
  # filter out 2003 as clubs info were missing
  summarise("Player" = n_distinct(player)) %>%
  ungroup()

# Visualise the combination of domestical and foreign elements
domestic %>%
  group_by(club) %>%
  # all clubs will have majority of their players coming from the country
  mutate("origin" = ifelse(Player == max(Player), "Domestic", "Other"),
         prop = Player/sum(Player)) %>%
  group_by(club,origin) %>%
  summarise(prop = sum(prop)) %>%
  filter(origin == "Domestic") %>%
  ggplot(aes(fct_reorder(club, prop), prop)) +
  geom_col(stat = "identity", colour = "blue", fill = "blue") +
  coord_flip() +
  theme_bw() + 
  ylab("club") +
  xlab("% Domestical Player") +
  ggtitle("Percentage of domestical player of top 12")
```

We can see that Vancouver Whitecaps, 25-apr and Rivers Angels had most of their World Cup players coming from their own country. Other big names like Chelse, Arsena, Lyon or 1. FFC Frankfurt hold only 50% - 60% of their World Cup players domestic, other were exported. To understand better about how such composition would contribute to their performance in World Cup, we were tempted to see of all the international clubs featured in the World Cup, which one hold the highest of players and how would that related to their performance. However, the task of gathering the nation of each club took a lot of time and manual works, hence we referred to a study by FIFA for this question.

```{r fifa-research, fig.cap = "Players owner in World Cup 2019", out.height = "60%"}
knitr::include_graphics(here::here("wc_owner.png"))
```

In an article published on dw.com[@schacht_2019], FIFA has released their figures showing that US club held roughly 14% of total World Cup 2019 players - 73 players. That figure was very impressive if you considered there were hundreds of clubs from all over the world sending their players to the game. Followed behind were our familiar faces of Spain, France and England. The article also pointed out that Spain's national women team qualified for the game first time in 2015. By that time, there were only 21 of the players belonged to the top Spanish teams. In 2019, the number increased to 51. The article also suggested that this change came from a significant improve in supports for women's football in Spain in the recent years. 

The domination of US and the rising of Spain suggested how a nation would support their players. It was of nature that players would come to the clubs that offered them the best of conditions. The better the condition, the more likely to attract top players and finally the better performance at any tournament. The United States had crowned the championship at the World Cup for 4 times out of 8 times the Women World Cup was held until now.  

## Analysis by player

Next we will take a look deeper into the stars of the game - the players. In this section, we wanted to know if there are any factors that would determine a player's chance to participate in the World Cup, or even further, how these factors can tell about the performance of such player in the game.  

### Player's age
First of all, we will look at the overall age distribution of all the players through all eight World Cup tournaments.

```{r player-age, fig.cap = "Player's age distribution"}
squads %>%
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1 , color = "black", fill = "magenta") +
  theme_bw()+
  facet_wrap(~ year) +
  ggtitle("Player's age distribution")
```

We chosed the bindwith equals to 1, meaning each bindwith represented 1 year of age. We could ignore the count for each year as the number of teams participated were not similar for the all the years. Instead we will concentrate on the distribution. 

We can see that the age distribution by year varied quite significantly. From 1991 up to 2015, the age distribution was lightly right skewed, meaning players cluttered around the lower age - lower than 30 , around 20- 25 as we can refer from the charts. But coming to 2019, a clear shift was observed where the age cluttered around the higher age of 27. More observations were observed at points further beyond 30, indicating that players who qualified for World Cup are getting older than before.  

Next up, we will comb through the age of all participants that took part in the World Cup from the very first tournament in 1991 to the most recent in 2019.  

```{r country-age, fig.cap = "Summary of player age by country"}
player_age <- squads %>%
  group_by(year, country) %>%
  mutate(dummy = ifelse(country %in% c("US", "Norway", "Germany","Netherlands", "Japan", "China PR", "Sweden", "Brazil"),1, 0)) 

pa <- player_age %>%
  ggplot(aes(reorder(country, age, FUN = median), age, color = dummy)) +
  geom_boxplot() +
  theme_bw() +
  theme(axis.text.x=element_text(angle=90, hjust=1),
        legend.position = "none") +
  xlab("country") +
  ggtitle("Summary of player age by country")

ggplotly(pa)
```

On average, a World Cup player would not be younger than her 20s. The ideal age range for players would be around 25 to 27 years. The World Cup had witnessed a fair share of matured players who rocked the age of past 30s and even reached the 40s in history. Let's locate the winners and the runners up for all of the past World Cup and see how the ages varied.

We have United States (4 wins, 1 runner up), Norway (1 win, 1 runner up), Germany (2 wins, 1 runner up), Japan (1 win, 1 runner up), China PR, Sweden, Brazil and Netherlands (each had 1 runner up). I have highlighted the countries mentioned in the chart above for easier reference. We can see that most of the countries resided on the right half of the chart, indicating a higher than average median age of players. The 4-time champion US even had a long right tail where the maximum age could reach 39. Other highlighted countries also possessed some players with the age felt into the outliers that passed 35. We have Japan and China on the other half of the chart, with China seems to have younger ladies than the others. Japan even though on the other half, had a long right tail of age distribution where players can get to the age of 36. 

### Player's cap

The number of caps of each player represents the number of times a player represents her team in an international play ground. 

Table \@ref(tab:arrangecapped) below summarised top 10 players with the highest caps in the history of World Cup, along with the country they presented, their positions, the clubs they played for and their caps and goals at the most recent time they participated in the World Cup. 

```{r arrangecapped}
most_capped <- squads %>%
  filter(year > 2003,
         !club == "Unattached") %>%
  select(-age, - squad_no) %>%
  group_by(player) %>%
  arrange(desc(year)) %>%
  slice(1) %>%
  arrange(desc(caps))

most_capped %>%
  head(10) %>%
  kable(caption = "Top 10 players with the highest caps") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Again, the US took up the majority of ranks in the ranking table, 4 out of 10. Among which, Kristine Lilly hold the highest records at the World Cup 2007 - her last World Cup before retirement. After that and up until now, no players have been able to surpass her. Christie Rampone got the closest at the moment with 32 caps in difference.

We will look further and compare the caps countries to countries. For this task, we would take into focus only two years 2015 and 2019, as these two years had the same number of participating teams, making it easier to compare.

However, for 2019, we had to cross Nigeria and Cameroon off the list as these two countries missed a lot information regrading the caps and the goals. The result figure is presented below:

```{r cap-by-year, fig.cap = "Comparison of cap bar by year"}
capped_2019 <- most_capped %>%
  # filter countries with NA
  filter(year == 2019,
         !country %in% c("Nigeria", "Cameroon")) %>%
  group_by(country) %>%
  ggplot(aes(reorder(country, caps, FUN = median, na.rm = TRUE), caps)) +
  geom_boxplot() +
  theme_bw() +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("country in 2019") +
  coord_flip()
  ggtitle("Summary of player cap by country")
  
capped_2015 <- most_capped %>%
  filter(year == 2015) %>%
  group_by(country) %>%
  ggplot(aes(reorder(country, caps, FUN = median), caps)) +
  geom_boxplot() +
  theme_bw() +
  theme(axis.text.x=element_text(angle=90, hjust=1)) +
  xlab("country in 2015") +
  coord_flip()
  ggtitle("Summary of player cap by country")
  
capped_both <- grid.arrange(capped_2019,capped_2015, ncol = 2)
```

Surprisingly, the US team, even though still at the top, actually had their caps lowering in 2019 compared to 2015, with only Carli Lloyd having the caps high enough to become an outliner. Most of the celebrity teams (teams that had won and achieved runner up), except for China PR and Brazil, saw their median caps dropped. Expanding further from the top 10 highest cap in table \@ref(tab:arrangecapped) above to the top 30, we only had 12 players who participated in the World Cup 2019. Whilst we cannot calculate the impact of such drops on the teams' performance (US still won and Netherlands was the runner up in 2019), we can try to explain the reasons behind such drop in caps.

It could possibly mean that the celebrity team either (1) had their prestige players reaching the retirement age (If you revisit the top 10 table, you would see that most players in top 10 born in late 70s and early 80s) so they had to drop out of the tournament or (2) the celebrity team considered to save their ace players for other premier leagues rather than exhaust them in the World Cup. Whilst we can infer the assumption (1) from the date of birth provided, we had no solid base for the assumption (2). All we know at the moment is that FIFA has stepped in to encourage the teams to "collaborate" in exchange for a handsome commission under the form of supports given to the clubs helping them build up their talents. 

A bonus fun fact for this graph: 2019 was the first year Jamaica qualified for the World Cup and the teams comprised of members who never have once played for any Jamaica clubs! 

### Relationship between the age, the caps and the goals

We will conclude this section by examining the relationship between the age, the caps and the goals of a World Cup player whether one or more variables would explain the other, or in this case, whether the caps and age of a player would determine her ability to score more goals.

In this section we used _ggscatmat_ function to visualise the relationship between the variables in four different years, from 2007 to 2019. Again years before 2003 were filtered out due to lack of information. 

```{r relation, fig.cap = "Relationship between ages, caps and goals"}
library(GGally)
# filter out 2003 and forwards due to lack of info
squads %>% 
  filter(year > 2003) %>%
  ggscatmat(columns = 6:8, color = "year", alpha = 0.5) +
  scale_colour_brewer(palette="Set1") +
  theme_bw() + 
  xlab("") +
  ylab("") +
  ggtitle("Relationship between ages, caps and goals")
```

In figure \@ref(fig:relation), we have the density plot for each variables, the correlation for each pair of variables and the scatter plot. Some insights we can draw from the club would include:  

- The caps and the goals have a higher density at the lower values, which is not surprising. The caps, unlike the goals of which the density steeply dropped as the goals increased, have a notable lump at around 20 - 30 caps for all the year observed. Year 2011 and 2015 also observed another minor lump near 100 caps. However, year 2019 saw a dip at the point. We have concluded from the previous section that in 2019, the number of high capped players greatly decreased compared to the previous years.  
- Age and caps have a roughly positive relation where the higher the age, the more foreign experience a player most likely has. However, the relation was not definitive for year 2015 as we can see a handful of players at high age that did not possess a lot of caps (the green dots scattered at the lower right end of the chart).  
- Unlike the age and caps relation, there was not a recognizable relation between the age and the goals. Higher age does not necessarily associate with higher goals. In fact, most goals were scored by players in their 20s - 30s. However, 2011 and 2015 had a noticeable amount of scatter plots at the right hand side of the plot. These dots could presented the Goal keepers who may possess a high caps but have no needs to score a goal.  
- There seemed to be two cut off points in the caps - goals scatter plot: one at 100 caps and the other at nearly 200 caps. Before 100 caps, most plots cluttered in the lower left corner where higher caps had roughly the same goals. Pass 100, we started to see an upwards trend where higher caps led to higher goals, even though this trend mostly happened for 2015 and 2019. Pass 200 caps, there was hardly any players left at this point. We had some high caps but with low goals, they might be goal keepers. But if we had high caps with high goals, the goals were extraordinary high, as in the plot we can see some points flied far and beyond to the upper right corner of the plot.    



# Conclusion

In this exercise, we have learnt to 

- The better the condition, the more likely to attract top players and finally the better performance at any tournament.

- On average, a World Cup player would not be younger than her 20s. The ideal age range for players would be around 25 to 27 years

- It could possibly mean that the celebrity team either (1) had their prestige players reaching the retirement age (If you revisit the top 10 table, you would see that most players in top 10 born in late 70s and early 80s) so they had to drop out of the tournament or (2) the celebrity team considered to save their ace players for other premier leagues rather than exhaust them in the World Cup

- Countries that have more players imported will perform better. counter intuitive but make senses. 

- The caps and the goals have a higher density at the lower values, which is not surprising. The caps, unlike the goals of which the density steeply dropped as the goals increased, have a notable lump at around 20 - 30 caps for all the year observed. Year 2011 and 2015 also observed another minor lump near 100 caps. However, year 2019 saw a dip at the point. We have concluded from the previous section that in 2019, the number of high capped players greatly decreased compared to the previous years.

- Age and caps have a roughly positive relation where the higher the age, the more foreign experience a player most likely has

- Unlike the age and caps relation, there was not a recognizable relation between the age and the goals. Higher age does not necessarily associate with higher goals. In fact, most goals were scored by players in their 20s - 30s.

- There seemed to be two cut off points in the caps - goals scatter plot: one at 100 caps and the other at nearly 200 caps



# Acknowledge

The packages used are as follows:


- ggpplot2 [@ggplot2]

- tidyverse [@tidyverse]

- kableExtra [@kableExtra]

- bookdown [@bookdown]

- dplyr [@dplyr]

- plotly [@plotly]

- GGally [@ggaly]



# References

